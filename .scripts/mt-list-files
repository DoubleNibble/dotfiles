#!/usr/bin/env node

/* global require process console */

const { lstatSync, readdirSync, writeFileSync } = require('fs');
const { join } = require('path');

const { argv: [program, thisFile, inputDir, outputFile = './list-of-files.txt'] } = process;
const { log } = console;

const inflateInput = (inputDirs, parentDir = './') =>
      inputDirs.map(
          inputDir =>
              (
                  item =>
                      lstatSync(item).isDirectory()
                      ? inflateInput(readdirSync(item), item)
                      : [item]
              )(join(parentDir, inputDir))
      ).reduce(
          (a, c) => a.concat(c),
          []
      );

const arrayToVerticalList = inputArray =>
      inputArray.reduce((a, c) => `${a}${c}\n`, '');

const listOfFiles = arrayToVerticalList(inflateInput([inputDir]));

writeFileSync(outputFile, listOfFiles);

log(listOfFiles);
log(`File created: ${outputFile}`);
