#!/usr/bin/env bash

# Init
mt_setup_dir="$(dirname "${BASH_SOURCE[0]}")"
. "${mt_setup_dir}/tasks"

# Prepare twiner
if [ -d ~/.twiner ]; then
    cd ~/.twiner
    git pull
else
    git clone https://github.com/myTerminal/twiner.git ~/.twiner
fi
. ~/.twiner/load

# Perform platform-specific setup
if [ $(uname) = 'Linux' ] && [ $(command -v pacman) ]; then
    . "${mt_setup_dir}/linux/run"
elif [ $(uname) = 'Darwin' ]; then
    . "${mt_setup_dir}/mac/run"
else
    mt_abort_setup "Unknown platform found."
fi

# Perform platform-independent setup
tw_confirm "Generate SSH key?" \
           mt_task_generate_ssh_key \
           "Generation of SSH key skipped."
tw_confirm "Install global NPM packages?" \
           mt_task_install_npm_packages \
           "Installing NPM packages skipped."
tw_confirm "Create cloud symlinks?" \
           mt_task_create_cloud_symlinks \
           "Creation of cloud symlinks skipped."
tw_confirm "Clone GitHub source projects?" \
           mt_task_clone_github_source_projects \
           "Cloning GitHub source projects skipped."

# Prompt for a reboot
tw_confirm "Setup is complete, reboot now?" \
           tw_reboot_now \
           "Reboot skipped."
